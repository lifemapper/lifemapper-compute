<?xml version="1.0" standalone="no"?>

<kickstart>


	<description>
	Lifemapper roll (lmcompute)
	Install on the frontend and compute nodes of the lmcompute cluster	
	</description>

	<copyright>
	Copyright (c) 2000 - 2012 The Regents of the University of California.
	All rights reserved. Rocks(r) v5.5/v6.0 www.rocksclusters.org
	
	</copyright>

	<changelog>
	$Log$
	</changelog>

	<package>lifemapper-cctools</package>
	<package>lifemapper-proj</package>
	<package>lifemapper-geos</package>
	<package>lifemapper-gdal</package>
	<package>lifemapper-tiff</package>
	<package>lifemapper-openmodeller</package>
	<package>lifemapper-lmcompute</package>
	<package>lifemapper-spatialindex</package>

	<package>gsl</package>
	<package>gsl-devel</package>
	<package>hdf4</package>
	<package>hdf4-devel</package>
	<package>hdf5</package>
	<package>hdf5-devel</package>
	<package>sqlite-devel</package>

	<package>opt-lifemapper-pysal</package>
	<package>opt-lifemapper-rtree</package>
	<package>opt-lifemapper-scipy</package>
	<package>opt-lifemapper-egenix-mx-base</package>

	<package>opt-lifemapper-dateutil</package>
	<package>opt-lifemapper-pyparsing</package>
	<package>opt-lifemapper-matplotlib</package>
	<package>opt-lifemapper-futures</package>
	<package>opt-lifemapper-requests</package>

	<package>rocks-lmcompute</package>
<post>

/sbin/ldconfig

# Node directory NOT shared from frontend
mkdir -p /state/partition1/lmscratch
mkdir -p /state/partition1/lmscratch/job
mkdir -p /state/partition1/lmscratch/temp
chgrp -R lmwriter /state/partition1/lmscratch
chmod -R g+ws /state/partition1/lmscratch

# scratch space for job computation
mkdir -p /state/partition1/lm
mkdir -p /state/partition1/lm/jobs

# these directories allow lock files on each node, lmwriter must have rw
mkdir -p /state/partition1/lm/.java
mkdir -p /state/partition1/lm/.java/.systemPrefs
mkdir -p /state/partition1/lm/.java/.userPrefs

chgrp -R lmwriter /state/partition1/lm
chmod -R g+ws /state/partition1/lm


<file name="/etc/rc.d/rocksconfig.d/post-99-lifemapper-lmcompute" perms="0700">
#!/bin/bash
# do LM initializaton

/sbin/ldconfig
/opt/lifemapper/rocks/bin/initLMcompute
rm -rf /etc/rc.d/rocksconfig.d/post-99-lifemapper-lmcompute

</file>

</post>

</kickstart>
