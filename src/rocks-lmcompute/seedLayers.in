#!/bin/bash 

# Purpose: populate nodes with data and catalog them in Sqlite database
#

usage () 
{
    echo "Usage: $0"
    echo "This script is run by the superuser. It will "
    echo "     - run seedLayers.py to install layers and populate sqlite database on each node "
    echo "   "
    echo "The output of the script is in /tmp/`/bin/basename $0`.log"
}

### define varibles
SetDefaults () {
    # script to seed layers
    SEEDER_SCRIPT=@LMHOME@/LmCompute/scripts/layerSeeder.py
    SEEDER_ARGFILE=@LMHOME@/LmCompute/scripts/layerPairs.csv
    LOG=/tmp/`/bin/basename $0`.log
    touch $LOG
    TimeStamp "# Start"
}

TimeStamp () {
    echo $1 `/bin/date` >> $LOG
}

### read the identifiers and relative path of layer files
SeedLayers () {
    if [ -f $SEEDER_SCRIPT ] ; then
        echo "Running $SEEDER_SCRIPT ..." | tee -a $LOG
        /opt/python/bin/@PYTHONVER@ $SEEDER_SCRIPT $SEEDER_ARGFILE 2>&1 | tee -a $LOG
    else
        echo "Error: Missing $SEEDER_SCRIPT " | tee -a $LOG
        exit 1
    fi
}

### Main ###
if [ $# -ne 0 ]; then
    usage
    exit 0
fi 

SetDefaults
SeedLayers
TimeStamp "# End"
